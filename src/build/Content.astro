---
import { type SchemaRegistry, componentRegistry } from "~/build/components";
import { type Pos, swapPos } from "@sections/styles";

type Props = {
  components: SchemaRegistry;
  startPos: Pos;
};

const { components, startPos } = Astro.props;

let pos: Pos = swapPos(startPos);

const builtComponents =
  components !== null
    ? await Promise.all(
        components.map(async (props) => {
          return {
            component: await componentRegistry[props.type]?.load(),
            props,
          };
        }),
      )
    : [];
---

{
  builtComponents.length !== 0 &&
    builtComponents.map((data) => {
      if ("pos" in data.props) {
        data.props.pos = swapPos(pos);
        // what the fuck is the lsp on
        pos = data.props.pos as Pos;
      }

      return data ? <data.component.default {...data.props} /> : null;
    })
}
