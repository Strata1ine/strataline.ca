---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import SplitCard from "~/components/cards/Split.astro";
import Container from "~/components/div/Container.astro";
import ContainerTitle from "~/components/div/ContainerTitle.astro";
import { Pos } from "~/components/variants.ts";

const { title, titlePos = Pos.Left } = Astro.props;
const [index] = await getCollection("index");
const serviceData = await getCollection("services");

function next(i: number) {
  return i % 2 === Number(titlePos) ? Pos.Left : Pos.Right;
}

const services = serviceData.filter((service) =>
  index.data.popular.some((pattern) => service.slug.includes(pattern)),
);
---

<Container>
  <ContainerTitle title={title} variant={titlePos} />
  {
    services.map((service: any, i) => (
      <SplitCard
        title={service.data.title}
        description={service.data.description}
        variant={next(i)}
      >
        {service.data.covers.map((img, _) => (
          <Image src={img.path} alt={img.alt} />
        ))}
      </SplitCard>
    ))
  }
</Container>

<slot />
