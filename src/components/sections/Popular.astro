---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Popular from "~/components/nav/Popular.astro";
import Container from "~/components/div/Container.astro";
import ContainerTitle from "~/components/div/ContainerTitle.astro";
import { Pos } from "~/components/variants.ts";

const { title, titlePos = Pos.Left } = Astro.props;
const [index] = await getCollection("index");
const serviceData = await getCollection("services");

function next(i: number) {
  return i % 2 === Number(titlePos) ? Pos.Left : Pos.Right;
}

const services = serviceData.filter((service) =>
  index.data.popular.some((pattern) => service.slug.includes(pattern)),
);

const { ...slot } = Astro.props;
---

<Container {...slot}>
  <ContainerTitle title={title} variant={titlePos} />
  {
    services.map((service: any, i) => (
      <Popular data={service.data} variant={next(i)} slug={service.slug}>
        {service.data.covers.map((img: any, _: number) => (
          <Image width={2560} src={img.src} alt={img.alt} />
        ))}
      </Popular>
    ))
  }
</Container>

<slot />
