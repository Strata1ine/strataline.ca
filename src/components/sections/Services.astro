---
import Island from "./TextCarousel.svelte";
import LayoutDivider from "./layout/Divider.astro";
import LayoutTitle from "./layout/Title.astro";

import { getEntry, getCollection } from "~/content.config";
import { imageOpts } from "~/build/images";

import { type PropsOf } from "./registry";
const meta = Astro.props as PropsOf<"Services">;

let exclude: string[];
if (meta.exclude == undefined) {
  const index = await getEntry("index", "index");
  exclude = index.data.popular;
} else {
  exclude = meta.exclude;
}

const services = (await getCollection("services")).filter(
  (service) => !exclude.some((pattern: string) => service.id.includes(pattern)),
);

import { containerStyles, imageStyles } from "./styles";
import clsx from "clsx";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
---

<LayoutDivider id={meta.id}>
  <LayoutTitle title={meta.title} pos={meta.pos} />

  <div class="bg-accent">
    <nav
      class={clsx(
        containerStyles({ width: "inner", gap: "sm" }),
        "flex flex-wrap justify-center py-12 md:py-22",
      )}
    >
      {
        services.map((service, _) => {
          const slug = service.id.split("/")[0];
          return (
            <a
              class="flex w-full items-center gap-5 sm:max-w-1/2 sm:flex-[40%] sm:flex-col lg:max-w-1/3 lg:flex-[30%]"
              href={`/services/${slug}`}
              tabindex="0"
            >
              <Image
                class={`h-[30vw] max-h-65 min-h-30 w-1/2 rounded-sm sm:w-full ${imageStyles({ anim: "hover" })}`}
                src={service.data.covers[0].meta}
                alt={service.data.covers[0].alt}
                {...imageOpts}
              />

              <div class="flex flex-col gap-3 sm:w-full sm:flex-row sm:items-center sm:gap-6">
                <h3 class="heading-xl">{service.data.title}</h3>

                <Icon name="arrow" is:inline />
              </div>
            </a>
          );
        })
      }
    </nav>
  </div>

  {meta.content && <Island client:visible meta={meta.content} />}
</LayoutDivider>
