---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import Arrow from "~/assets/arrow.svg";
import Container, { ContainerVariant } from "~/components/div/Container.astro";
import ContainerTitle from "~/components/div/ContainerTitle.astro";
import { Pos } from "~/components/variants.ts";

const { title, titlePos = Pos.Left } = Astro.props;
const [index] = await getCollection("index");
const serviceData = await getCollection("services");

const services = serviceData.filter(
  (service) =>
    !index.data.popular.some((pattern) => service.slug.includes(pattern)),
);

const { ...slot } = Astro.props;
---

<Container variant={ContainerVariant.Max} {...slot}>
  <ContainerTitle class="px-inset" title={title} variant={titlePos} />

  <slot name="top" />
  <div class="bg-accent">
    <Container
      class="bg-accent grid grid-cols-1 place-items-center gap-5 py-20 sm:grid-cols-2 sm:gap-9 lg:grid-cols-3"
      variant={ContainerVariant.Inner}
      as="div"
    >
      {
        services.map((service: any, i) => (
          <a
            href="#wasd"
            class="flex h-full w-full items-center gap-3 sm:flex-col sm:items-baseline"
          >
            <Image
              class="min-h-30 w-1/2 rounded-md object-cover transition duration-300 hover:scale-[1.05] sm:h-65 sm:w-full"
              width={808}
              height={416}
              fetchpriority={i == 0 ? "high" : "low"}
              src={service.data.covers[0].path}
              alt={service.data.covers[0].alt}
            />
            <div class="flex w-1/2 flex-col justify-between gap-2 sm:w-full sm:flex-row sm:items-center">
              <h4 class="font-serif text-xl">{service.data.title}</h4>
              <Arrow />
            </div>
          </a>
        ))
      }
    </Container>
  </div>

  <slot name="bottom" />
</Container>
