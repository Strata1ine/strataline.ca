---
import { container, heading } from "@sections/meta.ts";
import clsx from "clsx";

import TextCarousel from "./TextCarousel.astro";
import { Icon } from "astro-icon/components";

const { index, serviceCovers } = Astro.locals;
const {
  title = "There's more to explore",
  pos = Astro.locals.getNextPos(),
  text,
  speed,
  id: elementId,
  exclude = index.data.popular,
} = Astro.props;

const services = Astro.locals.services.filter(
  (service) =>
    !exclude.some((pattern: string) =>
      service.id.split("/")[0].includes(pattern),
    ),
);
---

<section class={container({ intent: "div" })} id={elementId}>
  <h2 class={clsx(container({ intent: "inner" }), heading({ align: pos }))}>
    {title}
  </h2>

  <div class="bg-accent">
    <nav
      class={clsx(
        container({ intent: "inner" }),
        "flex flex-wrap justify-center gap-6 py-12 md:py-22 sm:gap-y-12 2xl:gap-7",
      )}
    >
      {
        services.map((service, _) => {
          const slug = service.id.split("/")[0];
          const covers = serviceCovers.get(service.id);
          if (covers == null) return;

          return (
            <a
              class="flex w-full items-center gap-3 sm:max-w-1/2 sm:flex-[40%] sm:flex-col lg:max-w-1/3 lg:flex-[30%]"
              href={`/services/${slug}`}
            >
              <img
                class="h-[30vw] max-h-65 min-h-30 w-1/2 rounded-sm object-cover transition duration-300 select-none hover:scale-[1.05] sm:w-full"
                {...covers[0]}
              />

              <div class="gam-2 flex flex-col sm:w-full sm:flex-row sm:items-center sm:gap-4">
                <h3 class="text-md sm:text-bg font-serif md:text-xl">
                  {service.data.title}
                </h3>

                <Icon name="arrow" is:inline />
              </div>
            </a>
          );
        })
      }
    </nav>
  </div>

  <TextCarousel text={text} speed={speed} />
</section>
