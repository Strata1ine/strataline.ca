---
import { parseHTML } from "linkedom";
import { appendAttrElements, setAttrElements } from "~/lib/processHTML";

const html = await Astro.slots.render("default");
const { document } = parseHTML(html);

const styles = {
  h1: "font-serif font-bold text-5xl mb-10",
  h2: "font-serif font-bold text-2xl mb-1 mt-8",
  h3: "font-serif font-bold text-xl mb-1 mt-8",
  h4: "font-serif font-bold text-lg mb-1 mt-8",
  p: "font-sans text-base my-1",
  ul: "list-disc pl-5 my-4",
  ol: "list-decimal marker:font-bold marker:font-serif pl-5 my-4",
  li: "font-sans text-base my-1",
  hr: "my-5 border-accent",
  strong: "font-medium",
};

Object.entries(styles).forEach(([selector, classes]) => {
  setAttrElements(
    Array.from(document.querySelectorAll(selector)).filter(
      (el) => el.classList.length === 0,
    ),
    "class",
    classes,
  );
});

appendAttrElements(
  document.querySelectorAll(
    "p:first-child:not(:only-of-type), p:first-of-type:not(:only-of-type)",
  ),
  "class",
  "mb-1",
  "my-1",
);

appendAttrElements(
  document.querySelectorAll(
    "p:last-of-type:not(:only-of-type), p:last-child:not(:only-of-type)",
  ),
  "class",
  "mt-1",
  "my-1",
);

appendAttrElements(
  document.querySelectorAll("p:only-of-type, li:only-of-type"),
  "class",
  "",
  "my-1",
);

appendAttrElements(
  document.querySelectorAll(
    "li:first-child:not(:only-of-type), li:first-of-type:not(:only-of-type)",
  ),
  "class",
  "mb-1",
  "my-1",
);

appendAttrElements(
  document.querySelectorAll(
    "li:last-child:not(:only-of-type), li:last-of-type:not(:only-of-type)",
  ),
  "class",
  "mt-1",
  "my-1",
);
---

<Fragment set:html={document} />
