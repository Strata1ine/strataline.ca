---
import Layout from "~/layouts/Layout.astro";
import ServiceHero from "@sections/ServiceHero.astro";
import Menus from "@modals/Menus.svelte";

import { getCollection } from "~/content.config";
import Content from "~/build/Content.astro";
import Footer from "@sections/Footer.astro";

export async function getStaticPaths() {
  return (await getCollection("services")).map((service: any) => ({
    params: { slug: service.id.split("/")[0] },
  }));
}

const { slug } = Astro.params;
const service = (await getCollection("services")).find(
  (s) => s.id.split("/")[0] === slug,
)!;
---

<Layout
  title={service.data.title}
  desc={service.data.seo}
  schemas={{
    "@type": "Service",
    "@id": `${Astro.url.origin}${Astro.url.pathname}#service`,
    serviceType: "Home Renovation",
    name: service.data.title,
    description: service.data.desc,
    image: service.data.covers.map((cover) => ({
      "@type": "ImageObject",
      url: `${Astro.url.origin}${cover.meta.src}`,
      description: cover.alt,
    })),
    offers: {
      "@type": "Offer",
      "@id": `${Astro.url.origin}${Astro.url.pathname}#offer`,
    },
  }}
>
  <ServiceHero meta={service.data} {slug} />
  <Content
    startPos={service.data.startPos ?? "right"}
    components={service.data.components}
  />
  <Footer />
  <Menus client:idle />
</Layout>
