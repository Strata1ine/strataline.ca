---
import { type SchemaOf, createSchema } from 'astro-frontmatter-components';
import { type SchemaContext, z } from 'astro:content';
import { DefaultPos } from '@/schemas';

import { schema as textCarousel } from './TextCarousel.astro';
export const schema = createSchema((c: SchemaContext) => ({
	id: z.string().optional(),
	pos: DefaultPos,
	title: z.string().default("There's more to explore"),
	exclude: z.array(z.string()).optional(),
	content: z.object(textCarousel(c)).optional(),
}));

import { getEntry, getCollection } from '@/content.config';

export type Props = SchemaOf<typeof schema>;
const meta = Astro.props;

let exclude: string[];
if (meta.exclude == undefined) {
	const index = await getEntry('index', 'index');
	exclude = index.data.popular;
} else {
	exclude = meta.exclude;
}

const services = (await getCollection('services')).filter(
	(service) => !exclude.some((pattern: string) => service.id.includes(pattern)),
);

import { Icon } from 'astro-icon/components';
import { Image } from '@/components/Image';

import * as Layout from '@/components/Layout';
import Island from './TextCarousel';
---

<Layout.Divider id={meta.id}>
	<Layout.Title title={meta.title} pos={meta.pos} />

	<div class="bg-accent">
		<Layout.Container
			variant="inner"
			class="flex flex-wrap justify-center gap-6 py-12 md:py-22 xl:gap-8"
		>
			{
				services.map((service, _) => {
					const slug = service.id.split('/')[0];
					return (
						<a
							class="flex w-full items-center gap-5 sm:max-w-1/2 sm:flex-[40%] sm:flex-col lg:max-w-1/3 lg:flex-[30%]"
							href={`/services/${slug}`}
							id={slug}
							tabindex="0"
							draggable={false}
						>
							<Image
								class="aspect-[16/10] w-1/2 rounded-sm sm:w-full"
								anim="hover"
								image={service.data.image}
								widths={[200, 400, 600, 800]}
							/>

							<div class="flex flex-col gap-3 sm:w-full sm:flex-row sm:items-center sm:gap-6">
								<h3 class="font-serif text-2xl text-balance sm:text-2xl xl:text-3xl">
									{service.data.title}
								</h3>

								<Icon aria-hidden={true} name="arrow" is:inline />
							</div>
						</a>
					);
				})
			}
		</Layout.Container>
	</div>

	{meta.content && <Island client:visible meta={meta.content} />}
</Layout.Divider>
