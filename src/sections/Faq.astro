---
import { type SchemaOf, createSchema } from 'astro-frontmatter-components';
import { type SchemaContext, z } from 'astro:content';
import { DefaultPos } from '@/schemas';
import business from '#/business.json';

export const schema = createSchema('Faq', (_: SchemaContext) => ({
	id: z.string().optional(),
	pos: DefaultPos,
	title: z.string(),
	content: z.array(
		z.object({
			title: z.string(),
			desc: z.string(),
		}),
	),
}));

export const seo = async (Astro: Astro, faqs: Props[]) => {
	return {
		'@type': 'FAQPage',
		mainEntity: await Promise.all(
			faqs.flatMap((faq) =>
				faq.content.map(async (content) => ({
					'@type': 'Question',
					name: content.title,
					acceptedAnswer: {
						'@type': 'Answer',
						text: await markdown.parse(content.desc),
					},
				})),
			),
		),
		provider: {
			'@type': business['@type'],
			'@id': `${Astro.url.origin}#company`,
		},
	};
};

export type Props = SchemaOf<typeof schema>;
const meta = Astro.props as Props;

import markdown from '@/build/markdown';
for (const faq of meta.content) {
	faq.desc = await markdown.parse(faq.desc);
}

import * as Layout from '@/components/Layout';
import Island from './Faq';
---

<Layout.Divider id={meta.id}>
	<Layout.Title title={meta.title} pos={meta.pos} />

	<Layout.Container variant="inner">
		<Island client:load content={meta.content} />
	</Layout.Container>
</Layout.Divider>
